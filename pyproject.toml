[project]
name = "stdatamodels"
description = "Core support for DataModel classes used in calibration pipelines"
requires-python = ">=3.10"
authors = [
    { name = "STScI" },
]
classifiers = [
    "Intended Audience :: Science/Research",
    "Topic :: Scientific/Engineering :: Astronomy",
    "License :: OSI Approved :: BSD License",
    "Programming Language :: Python :: 3",
]
dependencies = [
    "asdf>=3.1.0",
    "asdf-transform-schemas>=0.5.0",
    "asdf-astropy>=0.3.0",
    "numpy>=1.18",
    "astropy>=5.0.4",
]
dynamic = [
    "version",
]

[project.readme]
file = "README.md"
content-type = "text/markdown"

[project.license]
file = "LICENSE"
content-type = "text/plain"

[project.urls]
Homepage = "https://github.com/spacetelescope/stdatamodels"
"Bug Tracker" = "https://github.com/spacetelescope/stdatamodels/issues"
"Source Code" = "https://github.com/spacetelescope/stdatamodels"

[project.entry-points."asdf.extensions"]
jwst_pipeline = "stdatamodels.jwst.transforms.integration:get_extensions"

[project.entry-points."asdf.resource_mappings"]
jwst_datamodel = "stdatamodels.jwst.datamodels.integration:get_resource_mappings"
jwst_pipeline = "stdatamodels.jwst.transforms.integration:get_resource_mappings"

[project.optional-dependencies]
test = [
    "psutil",
    "pyyaml",
    "pytest>=4.6.0",
    "pytest-doctestplus",
    "crds>=11.17.1",
]
docs = [
    "sphinx",
    "sphinx-automodapi",
    "numpydoc",
    "sphinx-rtd-theme",
    "sphinx-asdf>=0.1.1",
    'tomli; python_version <"3.11"',
]

[build-system]
requires = [
    "setuptools>=61.2",
    "setuptools_scm[toml]>=3.4",
    "wheel",
]
build-backend = "setuptools.build_meta"

[tool.setuptools]
zip-safe = true
include-package-data = false

[tool.setuptools.packages.find]
where = [
    "src",
]
namespaces = false

[tool.setuptools.package-dir]
"" = "src"

[tool.setuptools.package-data]
"*" = [
    "*.yaml",
]
"stdatamodels.jwst.transforms" = [
    "resources/schemas/stsci.edu/jwst_pipeline/*.yaml",
]

[tool.flake8]
exclude = [
    ".git",
    "__pycache__",
    "docs",
    "build",
    "dist",
    ".tox",
    ".eggs",
]
ignore = [
    "E203",
    "W503",
    "W504",
    "W605",
]
max-line-length = 130
select = [
    "F",
    "W",
    "E101",
    "E111",
    "E112",
    "E113",
    "E401",
    "E402",
    "E501",
    "E711",
    "E722",
]

[tool.pytest.ini_options]
minversion = "4.6"
doctest_plus = true
doctest_rst = true
text_file_format = "rst"
addopts = "--color=yes"
testpaths = [
    "docs",
    "tests",
    "src/stdatamodels/jwst",
]
filterwarnings = [
    # turn all warnings into errors, this includes ResourceWarning which
    # allows catching files left open by tests
    "error",
    # astropy table issues this warning on import so we ignore it here
    "ignore:numpy.ndarray size changed:RuntimeWarning",
]
asdf_schema_tests_enabled = true
asdf_schema_validate_default = false
asdf_schema_root = "src/stdatamodels/jwst/datamodels/schemas\nsrc/stdatamodels/jwst/transforms/resources/schemas"
norecursedirs = [
    "build",
    ".tox",
    ".eggs",
    "venv",
]

[tool.setuptools_scm]
write_to = "src/stdatamodels/_version.py"

[tool.coverage.run]
omit = [
    '*/tests/*',
]

[tool.towncrier]
filename = "CHANGES.rst"
directory = "changes"
package = "stdatamodels"
title_format = "{version} ({project_date})"
ignore = [".gitkeep"]
wrap = true
issue_format = "`#{issue} <https://github.com/spacetelescope/stdatamodels/issues/{issue}>`_"

[tool.towncrier.fragment.feature]
name = "New Features"

[tool.towncrier.fragment.bugfix]
name = "Bug Fixes"

[tool.towncrier.fragment.doc]
name = "Documentation"

[tool.towncrier.fragment.removal]
name = "Deprecations and Removals"

[tool.towncrier.fragment.misc]
